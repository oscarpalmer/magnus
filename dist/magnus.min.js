/*!
 * Magnus, v0.12.0
 * https://github.com/oscarpalmer/magnus
 * (c) Oscar PalmÃ©r, 2021, MIT @license
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Magnus=e()}(this,(function(){"use strict";class ControllerStore{constructor(t){this.application=t,this.store=new Map}add(t,e){const s=this.store.get(t);if(null==s)return;const r=new s.controller(this.application,t,e);e[t]=r,s.instances.set(e,r)}create(t,e){this.store.has(t)||this.store.set(t,{controller:e,instances:new Map})}get(t){var e,s;return Array.from(null!==(s=null===(e=this.store.get(t))||void 0===e?void 0:e.instances.values())&&void 0!==s?s:[])}remove(t,e){const s=this.store.get(t);null!=s&&s.instances.has(e)&&(delete e[t],s.instances.delete(e))}}class Observer{constructor(t){this.element=t,this.mutationObserverOptions=this.getOptions(),this.mutationObserver=new MutationObserver(this.observeMutations.bind(this))}disconnect(){this.mutationObserver.disconnect()}handleNodes(t,e){for(const s of null!=t?t:[])s.nodeType===Node.ELEMENT_NODE&&(this.handleElement(s,e),this.handleNodes(s.childNodes,e))}observe(){this.mutationObserver.observe(this.element,this.mutationObserverOptions),this.handleNodes(this.element.childNodes,!0)}getAttributes(t,e){const s=t.split(" "),r=e.split(" "),n=[],o=[];for(const t of s)""!==t&&-1===r.indexOf(t)&&o.push(t);for(const t of r)""!==t&&-1===s.indexOf(t)&&n.push(t);return[n,o]}observeMutations(t){var e,s;for(const r of t)r.type===Observer.MUTATION_RECORD_CHILDLIST?(this.handleNodes(r.addedNodes,!0),this.handleNodes(r.removedNodes,!1)):this.handleAttribute(r.target,null!==(e=r.attributeName)&&void 0!==e?e:"",null!==(s=r.oldValue)&&void 0!==s?s:"")}}Observer.MUTATION_OBSERVER_OPTIONS={attributeOldValue:!0,attributes:!0,childList:!0,subtree:!0},Observer.MUTATION_RECORD_CHILDLIST="childList";class DocumentObserver extends Observer{constructor(t){super(document.documentElement),this.store=t}getOptions(){const t=Object.assign({},Observer.MUTATION_OBSERVER_OPTIONS);return t.attributeFilter=[DocumentObserver.CONTROLLER_ATTRIBUTE],t}handleAttribute(t,e,s,r){var n;let o=null!==(n=t.getAttribute(e))&&void 0!==n?n:"";o!==s&&(!0===r&&(s=o,o=""),this.handleChanges(t,o,s))}handleElement(t,e){t.hasAttribute(DocumentObserver.CONTROLLER_ATTRIBUTE)&&this.handleAttribute(t,DocumentObserver.CONTROLLER_ATTRIBUTE,"",!e)}handleChanges(t,e,s){this.getAttributes(s,e).forEach(((e,s)=>{const r=0===s;for(const s of e)this.store[r?"add":"remove"](s,t)}))}}DocumentObserver.CONTROLLER_ATTRIBUTE="data-controller";class ControllerObserver extends Observer{constructor(t){super(t.element),this.attributeAction=`data-${t.identifier}-action`,this.attributeTarget=`data-${t.identifier}-target`,this.controller=t}getOptions(){const t=Object.assign({},Observer.MUTATION_OBSERVER_OPTIONS);return t.attributeFilter=[this.attributeAction,this.attributeTarget],t}handleAttribute(t,e,s,r){var n;let o=null!==(n=t.getAttribute(e))&&void 0!==n?n:"";if(o===s)return;!0===r&&(s=o,o="");const i=e===this.attributeAction?this.handleAction:this.handleTarget;this.handleChanges(t,s,o,i)}handleElement(t,e){[this.attributeAction,this.attributeTarget].forEach((s=>{this.handleAttribute(t,s,"",!e)}))}handleAction(t,e,s){if(this.controller.context.store.actions.has(e))return void this.controller.context.store.actions[s?"add":"remove"](e,t);if(!s)return;const r=e.split(":");if(r.length<2)return;const n=this.controller[r[1]];"function"==typeof n&&(this.controller.context.store.actions.create(e,r[0],n.bind(this.controller)),this.controller.context.store.actions.add(e,t))}handleChanges(t,e,s,r){this.getAttributes(e,s).forEach(((e,s)=>{const n=0===s;for(const s of e)r.call(this,t,s,n)}))}handleTarget(t,e,s){this.controller.context.store.targets[s?"add":"remove"](e,t)}}class ActionStore{constructor(){this.actions=new Map}add(t,e){const s=this.actions.get(t);null!=s&&(s.elements.add(e),e.addEventListener(s.type,s.callback))}create(t,e,s){this.actions.has(t)||this.actions.set(t,{callback:s,elements:new Set,type:e})}has(t){return this.actions.has(t)}remove(t,e){const s=this.actions.get(t);null!=s&&(s.elements.delete(e),e.removeEventListener(s.type,s.callback),0===s.elements.size&&this.actions.delete(t))}}class TargetStore{constructor(){this.targets=new Map}add(t,e){var s,r;this.targets.has(t)?null===(s=this.targets.get(t))||void 0===s||s.add(e):null===(r=this.targets.set(t,new Set).get(t))||void 0===r||r.add(e)}get(t){var e;return Array.from(null!==(e=this.targets.get(t))&&void 0!==e?e:[])}has(t){var e,s;return(null!==(s=null===(e=this.targets.get(t))||void 0===e?void 0:e.size)&&void 0!==s?s:0)>0}remove(t,e){const s=this.targets.get(t);null!=s&&(s.delete(e),0===s.size&&this.targets.delete(t))}}class Store{constructor(){this.actions=new ActionStore,this.targets=new TargetStore}}return{Application:class Application{constructor(){this.store=new ControllerStore(this),this.observer=new DocumentObserver(this.store)}add(t,e){this.store.create(t,e)}get(t){return this.store.get(t)}start(){this.observer.observe()}stop(){this.observer.disconnect()}},Controller:class Controller{constructor(t,e,s){this.identifier=e,this.element=s,this.context={application:t,observer:new ControllerObserver(this),store:new Store},this.context.observer.observe(),this.connect()}connect(){}hasTarget(t){return this.context.store.targets.has(t)}target(t){return this.targets(t)[0]}targets(t){return this.context.store.targets.get(t)}}}}));