/*!
 * Magnus, v0.10.0
 * https://github.com/oscarpalmer/magnus
 * (c) Oscar PalmÃ©r, 2021, MIT @license
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Magnus=e()}(this,(function(){"use strict";class ControllerStore{constructor(){this.store=new Map}add(t,e){const s=this.store.get(t);if(null==s)return;const r=new s.controller(t,e);e[t]=r,s.instances.set(e,r)}create(t,e){this.store.set(t,{controller:e,instances:new Map})}get(t){const e=this.store.get(t);return null==e?[]:Array.from(e.instances.values())}remove(t,e){const s=this.store.get(t);null!=s&&s.instances.has(e)&&(delete e[t],s.instances.delete(e))}}class Observer{constructor(t,e){this.identifier=t,this.element=e,this.attributeAction=`data-${this.identifier}-action`,this.attributeTarget=`data-${this.identifier}-target`,this.mutationOptions=this.getOptions(),this.mutationObserver=new MutationObserver(this.observeMutations.bind(this))}disconnect(){this.mutationObserver.disconnect()}handleNodes(t,e){if(null!=t&&t.length>0)for(const s of t)s.nodeType===Node.ELEMENT_NODE&&(this.handleElement(s,e),this.handleNodes(s.childNodes,e))}observe(){this.mutationObserver.observe(this.element,Observer.MUTATION_OBSERVER_OPTIONS)}getAttributes(t,e){const s=t.split(" "),r=e.split(" "),o=[],n=[];for(const t of s)""!==t&&-1===r.indexOf(t)&&n.push(t);for(const t of r)""!==t&&-1===s.indexOf(t)&&o.push(t);return[o,n]}getOptions(){const t=Observer.MUTATION_OBSERVER_OPTIONS;return this.element===document.documentElement?(t.attributeFilter=[Observer.CONTROLLER_ATTRIBUTE],t):(t.attributeFilter=[this.attributeAction,this.attributeTarget],t)}observeMutations(t){var e,s;for(const r of t)r.type===Observer.MUTATION_RECORD_CHILDLIST?(this.handleNodes(r.addedNodes,!0),this.handleNodes(r.removedNodes,!1)):this.handleAttribute(r.target,null!==(e=r.attributeName)&&void 0!==e?e:"",null!==(s=r.oldValue)&&void 0!==s?s:"")}}Observer.CONTROLLER_ATTRIBUTE="data-controller",Observer.MUTATION_OBSERVER_OPTIONS={attributeOldValue:!0,attributes:!0,childList:!0,subtree:!0},Observer.MUTATION_RECORD_CHILDLIST="childList";class DocumentObserver extends Observer{constructor(t){super("magnus",document.documentElement),this.store=t}handleAttribute(t,e,s){var r;const o=null!==(r=t.getAttribute(e))&&void 0!==r?r:"";e===Observer.CONTROLLER_ATTRIBUTE&&o!==s&&this.handleChanges(t,e,o,s)}handleElement(t,e){var s;if(!t.hasAttribute(Observer.CONTROLLER_ATTRIBUTE))return;const r=(null!==(s=t.getAttribute(Observer.CONTROLLER_ATTRIBUTE))&&void 0!==s?s:"").split(" ");this.toggleAttributes(t,r,e)}handleChanges(t,e,s,r){const o=this.getAttributes(r,s);for(let e=0;e<o.length;e+=1)this.toggleAttributes(t,o[e],0===e)}toggleAttributes(t,e,s){for(const r of e)s?this.store.add(r,t):this.store.remove(r,t)}}class ControllerObserver extends Observer{constructor(t){super(t.identifier,t.element),this.controller=t}handleAttribute(t,e,s,r){var o;let n=null!==(o=t.getAttribute(e))&&void 0!==o?o:"";if(n===s)return;!0===r&&(s=n,n="");const i=e===this.attributeAction?this.handleAction:this.handleTarget;this.handleChanges(t,s,n,i)}handleElement(t,e){[this.attributeAction,this.attributeTarget].forEach((s=>{this.handleAttribute(t,s,"",!e)}))}handleAction(t,e,s){if(this.controller.context.store.actions.has(e))return void(s?this.controller.context.store.actions.add(e,t):this.controller.context.store.actions.remove(e,t));if(!s)return;const r=e.split(":");if(r.length<2)return;const o=this.controller[r[1]];"function"==typeof o&&(this.controller.context.store.actions.create(e,r[0],o.bind(this.controller)),this.controller.context.store.actions.add(e,t))}handleChanges(t,e,s,r){const o=this.getAttributes(e,s);for(let e=0;e<o.length;e+=1)this.toggleAttributes(t,o[e],r,0===e)}handleTarget(t,e,s){s?this.controller.context.store.targets.add(e,t):this.controller.context.store.targets.remove(e,t)}toggleAttributes(t,e,s,r){for(const o of e)s.call(this,t,o,r)}}class ActionStore{constructor(){this.actions=new Map}add(t,e){const s=this.actions.get(t);null!=s&&(s.elements.add(e),e.addEventListener(s.type,s.callback))}create(t,e,s){this.actions.has(t)||this.actions.set(t,{callback:s,elements:new Set,type:e})}has(t){return this.actions.has(t)}remove(t,e){const s=this.actions.get(t);null!=s&&(s.elements.delete(e),e.removeEventListener(s.type,s.callback),0===s.elements.size&&this.actions.delete(t))}}class TargetStore{constructor(){this.targets=new Map}add(t,e){var s,r;this.targets.has(t)?null===(s=this.targets.get(t))||void 0===s||s.add(e):null===(r=this.targets.set(t,new Set).get(t))||void 0===r||r.add(e)}get(t){var e;return Array.from(null!==(e=this.targets.get(t))&&void 0!==e?e:[])}has(t){const e=this.targets.get(t);return null!=e&&e.size>0}remove(t,e){const s=this.targets.get(t);null!=s&&(s.delete(e),0===s.size&&this.targets.delete(t))}}class Store{constructor(){this.actions=new ActionStore,this.targets=new TargetStore}}return{Application:class Application{constructor(){this.store=new ControllerStore,this.observer=new DocumentObserver(this.store)}add(t,e){this.store.create(t,e)}start(){this.observer.observe(),this.observer.handleNodes(document.documentElement.childNodes,!0)}stop(){this.observer.disconnect()}},Controller:class Controller{constructor(t,e){this.identifier=t,this.element=e,this.context={observer:new ControllerObserver(this),store:new Store},this.context.observer.observe(),this.context.observer.handleNodes(this.element.childNodes,!0),this.connect()}connect(){}hasTarget(t){return this.context.store.targets.has(t)}target(t){return this.targets(t)[0]}targets(t){return this.context.store.targets.get(t)}}}}));