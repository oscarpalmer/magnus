/*!
 * Magnus, v0.15.0
 * https://github.com/oscarpalmer/magnus
 * (c) Oscar PalmÃ©r, 2021, MIT @license
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Magnus=e()}(this,(function(){"use strict";class Observer{constructor(t){this.element=t,this.options=this.getOptions(),this.observer=new MutationObserver(this.observe.bind(this))}start(){this.observer.observe(this.element,this.options),this.handleNodes(this.element.childNodes,!0)}stop(){this.observer.disconnect()}getAttributes(t,e){const s=t.split(" "),r=e.split(" "),o=[],n=[];for(const t of s)""!==t&&-1===r.indexOf(t)&&n.push(t);for(const t of r)""!==t&&-1===s.indexOf(t)&&o.push(t);return[o,n]}handleNodes(t,e){for(const s of null!=t?t:[])s.nodeType===Node.ELEMENT_NODE&&(this.handleElement(s,e),this.handleNodes(s.childNodes,e))}observe(t){var e,s;for(const r of t)r.type===Observer.CHILDLIST?(this.handleNodes(r.addedNodes,!0),this.handleNodes(r.removedNodes,!1)):this.handleAttribute(r.target,null!==(e=r.attributeName)&&void 0!==e?e:"",null!==(s=r.oldValue)&&void 0!==s?s:"")}}Observer.CHILDLIST="childList",Observer.OPTIONS={attributeOldValue:!0,attributes:!0,childList:!0,subtree:!0};class ControllerObserver extends Observer{constructor(t){super(t.element),this.context=t,this.attributeAction=`data-${t.identifier}-action`,this.attributeTarget=`data-${t.identifier}-target`}getOptions(){const t=Object.assign({},Observer.OPTIONS);return t.attributeFilter=[this.attributeAction,this.attributeTarget],t}handleAttribute(t,e,s,r){var o;let n=null!==(o=t.getAttribute(e))&&void 0!==o?o:"";if(n===s)return;!0===r&&(s=n,n="");const i=e===this.attributeAction?this.handleAction:this.handleTarget;this.handleChanges(t,s,n,i)}handleElement(t,e){[this.attributeAction,this.attributeTarget].forEach((s=>{this.handleAttribute(t,s,"",!e)}))}handleAction(t,e,s){if(this.context.store.actions.has(e))return void this.context.store.actions[s?"add":"remove"](e,t);if(!s)return;const r=e.split(":");if(r.length<2)return;const o=this.context.controller[r[1]];"function"==typeof o&&(this.context.store.actions.create(e,r[0],o.bind(this.context.controller)),this.context.store.actions.add(e,t))}handleChanges(t,e,s,r){this.getAttributes(e,s).forEach(((e,s)=>{const o=0===s;for(const s of e)r.call(this,t,s,o)}))}handleTarget(t,e,s){this.context.store.targets[s?"add":"remove"](e,t)}}class ActionStore{constructor(){this.actions=new Map}add(t,e){const s=this.actions.get(t);null!=s&&(s.elements.add(e),e.addEventListener(s.type,s.callback))}clear(){this.actions.forEach(((t,e)=>{t.elements.forEach((e=>{e.removeEventListener(t.type,t.callback)})),t.elements.clear()}))}create(t,e,s){this.actions.has(t)||this.actions.set(t,{callback:s,elements:new Set,type:e})}has(t){return this.actions.has(t)}remove(t,e){const s=this.actions.get(t);null!=s&&(s.elements.delete(e),e.removeEventListener(s.type,s.callback),0===s.elements.size&&this.actions.delete(t))}}class DataStoreHandlers{constructor(t){this.store=t}get(t,e){return Reflect.get(t,e)}set(t,e,s){return this.handleValue(e,Reflect.get(t,e),s),Reflect.set(t,e,s)}getProperty(t){return t.replace(DataStoreHandlers.PATTERN,(t=>t.toUpperCase()))}handleValue(t,e,s){let r;if(this.store.callbacks.has(t))return r=this.store.callbacks.get(t),void("function"==typeof r&&r.call(this.store.context.controller,s,e));r=this.store.context.controller[`data${this.getProperty(t)}Changed`],this.store.callbacks.set(t,r),"function"==typeof r&&r.call(this.store.context.controller,s,e)}}DataStoreHandlers.PATTERN=/^\w/;class DataStore{constructor(t){this.context=t,this.callbacks=new Map,this.handlers=new DataStoreHandlers(this),this.proxy=new Proxy({},this.handlers)}}class TargetStore{constructor(){this.targets=new Map}add(t,e){var s,r;this.targets.has(t)?null===(s=this.targets.get(t))||void 0===s||s.add(e):null===(r=this.targets.set(t,new Set).get(t))||void 0===r||r.add(e)}clear(){this.targets.forEach(((t,e)=>{t.clear()}))}get(t){var e;return Array.from(null!==(e=this.targets.get(t))&&void 0!==e?e:[])}has(t){return this.targets.has(t)}remove(t,e){const s=this.targets.get(t);null!=s&&(s.delete(e),0===s.size&&this.targets.delete(t))}}class Store{constructor(t){this.actions=new ActionStore,this.data=new DataStore(t),this.targets=new TargetStore}}class Context{constructor(t,e,s,r){this.application=t,this.identifier=e,this.element=s,this.store=new Store(this),this.observer=new ControllerObserver(this),this.controller=new r(this),this.observer.start(),"function"==typeof this.controller.connect&&this.controller.connect()}findElement(t){return this.element.querySelector(t)}findElements(t){return Array.from(this.element.querySelectorAll(t))}}class ControllerStore{constructor(t){this.application=t,this.controllers=new Map}add(t,e){const s=this.controllers.get(t);if(null==s)return;const r=new Context(this.application,t,e,s.controllerConstructor);e[t]=r.controller,s.instances.set(e,r.controller)}create(t,e){this.controllers.has(t)||this.controllers.set(t,{controllerConstructor:e,instances:new Map})}get(t){var e,s;return Array.from(null!==(s=null===(e=this.controllers.get(t))||void 0===e?void 0:e.instances.values())&&void 0!==s?s:[])}remove(t,e){const s=this.controllers.get(t);if(null==s)return;const r=s.instances.get(e);null!=r&&(r.context.observer.stop(),r.context.store.actions.clear(),r.context.store.targets.clear(),delete e[t],s.instances.delete(e),"function"==typeof r.disconnect&&r.disconnect())}}class DocumentObserver extends Observer{constructor(t){super(document.documentElement),this.controllers=t}getOptions(){const t=Object.assign({},Observer.OPTIONS);return t.attributeFilter=[DocumentObserver.ATTRIBUTE],t}handleAttribute(t,e,s,r){var o;let n=null!==(o=t.getAttribute(e))&&void 0!==o?o:"";n!==s&&(!0===r&&(s=n,n=""),this.handleChanges(t,n,s))}handleElement(t,e){t.hasAttribute(DocumentObserver.ATTRIBUTE)&&this.handleAttribute(t,DocumentObserver.ATTRIBUTE,"",!e)}handleChanges(t,e,s){this.getAttributes(s,e).forEach(((e,s)=>{const r=0===s;for(const s of e)this.controllers[r?"add":"remove"](s,t)}))}}DocumentObserver.ATTRIBUTE="data-controller";return{Application:class Application{constructor(){this.controllers=new ControllerStore(this),this.observer=new DocumentObserver(this.controllers)}add(t,e){this.controllers.create(t,e)}start(){this.observer.start()}stop(){this.observer.stop()}},Controller:class Controller{constructor(t){this.context=t}get data(){return this.context.store.data.proxy}get element(){return this.context.element}get identifier(){return this.context.identifier}hasTarget(t){return this.context.store.targets.has(t)}target(t){return this.context.store.targets.get(t)[0]}targets(t){return this.context.store.targets.get(t)}}}}));